<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8">
  <title>Songliste</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    :root {
      --bg: #0f1220; --fg: #e8eaf6; --muted: #b6b9d6;
      --border: #2a2d43; --accent: #7c9cff;
      --status-laeuft: #2e7d32; --status-geplant: #1565c0;
      --status-backlog: #8e24aa; --status-new: #f57c00;
    }
    body { font-family: system-ui, Segoe UI, Roboto, Arial; background: var(--bg); color: var(--fg); margin: 0; }
    .top-header {
      display: flex;
      align-items: center;
      gap: 16px;
      padding: 16px 20px;
      border-bottom: 1px solid var(--border);
    }
    .logo {
      height: 80px;
      width: auto;
      border-radius: 6px;
      background: #1a1d2e;
      padding: 4px;
    }
    .title-block h1 {
      font-size: 22px;
      margin: 0;
    }
    .subtitle {
      font-size: 14px;
      color: var(--muted);
      margin: 4px 0 0;
    }
    .controls { display: flex; gap: 12px; padding: 12px 20px; flex-wrap: wrap; }
    .controls input, .controls select { background: #151833; color: var(--fg); border: 1px solid var(--border); border-radius: 6px; padding: 8px 10px; }
    .table-wrap { padding: 0 20px 30px; }
    table { width: 100%; border-collapse: collapse; margin-top: 8px; }
    th, td { padding: 10px 12px; border-bottom: 1px solid var(--border); }
    th { text-align: left; font-weight: 600; color: var(--muted); cursor: pointer; }
    tr:hover { background: #141736; }
    .badge { display: inline-block; padding: 3px 8px; border-radius: 12px; font-size: 12px; font-weight: 600; }
    .b-laeuft { background: color-mix(in oklab, var(--status-laeuft) 35%, black); color: #c8e6c9; border: 1px solid color-mix(in oklab, var(--status-laeuft) 70%, black); }
    .b-geplant { background: color-mix(in oklab, var(--status-geplant) 35%, black); color: #bbdefb; border: 1px solid color-mix(in oklab, var(--status-geplant) 70%, black); }
    .b-backlog { background: color-mix(in oklab, var(--status-backlog) 35%, black); color: #e1bee7; border: 1px solid color-mix(in oklab, var(--status-backlog) 70%, black); }
    .b-new { background: color-mix(in oklab, var(--status-new) 35%, black); color: #ffe0b2; border: 1px solid color-mix(in oklab, var(--status-new) 70%, black); }
    .empty { color: var(--border); font-style: italic; }
    .count { font-size: 13px; color: var(--muted); margin-left: 8px; }
    footer { padding: 12px 20px; border-top: 1px solid var(--border); color: var(--muted); font-size: 13px; }
    @media (max-width: 720px) { td:nth-child(3) { display:none } }
  </style>
</head>
<body>
  <header class="top-header">
    <img src="MonkeysDesign/Monkey@Chris.jpg" alt="Bandlogo" class="logo">
    <div class="title-block">
      <h1>Orange Monkeys - Songlist<span class="count" id="count"></span></h1>
      <p class="subtitle">Bandprojekt · Übersicht aller Songs</p>
    </div>
  </header>

  <section class="controls">
    <input id="search" type="search" placeholder="Suche: Songname oder Interpret" aria-label="Suche">
    <select id="status">
      <option value="">Status: alle</option>
      <option value="läuft">läuft</option>
      <option value="geplant">geplant</option>
      <option value="backlog">backlog</option>
      <option value="new">new</option>
    </select>
  </section>

  <section class="table-wrap">
    <table id="table">
      <thead>
        <tr>
          <th data-key="Songname">Songname</th>
          <th data-key="Interpret">Interpret</th>         
          <th data-key="Spielstatus">Status</th>
          <th data-key="Leadsheet">Leadsheet</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </section>

  <footer>
    Copyright by OrangeMonkeys
  </footer>

  <script>
    const jsonPath = 'Songlist.json'; // JSON-Datei im gleichen Verzeichnis
    let data = [], sortKey = 'Songname', sortDir = 1;

    const tbody = document.querySelector('#table tbody');
    const countEl = document.getElementById('count');
    const searchEl = document.getElementById('search');
    const statusEl = document.getElementById('status');
    const ths = document.querySelectorAll('th[data-key]');

    fetch(jsonPath)
      .then(r => {
        if (!r.ok) throw new Error('JSON nicht gefunden: ' + jsonPath);
        return r.json();
      })
      .then(json => { data = json; render(); })
      .catch(err => {
        tbody.innerHTML = `<tr><td colspan="4">Fehler beim Laden: ${err.message}</td></tr>`;
      });

    function render() {
      const q = (searchEl.value || '').toLowerCase();
      const st = statusEl.value || '';
      const filtered = data.filter(row => {
        const text = (row.Songname + ' ' + row.Interpret).toLowerCase();
        const statusOk = !st || (row.Spielstatus || '').toLowerCase() === st.toLowerCase();
        return (!q || text.includes(q)) && statusOk;
      });

      const sorted = filtered.slice().sort((a, b) => {
        const av = (a[sortKey] || '').toString().toLowerCase();
        const bv = (b[sortKey] || '').toString().toLowerCase();
        return av.localeCompare(bv, 'de') * sortDir;
      });

      tbody.innerHTML = sorted.map(row => {
        const ls = row.Leadsheetbezeichnung && row.Leadsheetbezeichnung.trim() !== '' ? row.Leadsheetbezeichnung : '<span class="empty">—</span>';
        const s = (row.Spielstatus || '').toLowerCase();
        const badgeClass = s === 'läuft' ? 'b-laeuft'
                          : s === 'geplant' ? 'b-geplant'
                          : s === 'backlog' ? 'b-backlog'
                          : s === 'new' ? 'b-new'
                          : '';
        const badge = s ? `<span class="badge ${badgeClass}">${row.Spielstatus}</span>` : '<span class="empty">—</span>';
        return `<tr>
          <td>${escapeHtml(row.Songname || '')}</td>
          <td>${escapeHtml(row.Interpret || '')}</td>          
          <td>${badge}</td>
          <td>${ls}</td>
        </tr>`;
      }).join('');

      countEl.textContent = `(${sorted.length} Einträge)`;
    }

    searchEl.addEventListener('input', render);
    statusEl.addEventListener('change', render);

    ths.forEach(th => {
      th.addEventListener('click', () => {
        const key = th.dataset.key;
        if (sortKey === key) { sortDir *= -1; } else { sortKey = key; sortDir = 1; }
        render();
      });
    });

    function escapeHtml(str) {
      return str.replace(/[&<>"']/g, s => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[s]));
    }
  </script>
</body>
</html>
