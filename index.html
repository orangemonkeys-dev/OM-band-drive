async function loadFolders(path, bodyId, title) {
  const { owner, repo, branch } = CONFIG;
  const refSegment = branch ? `?ref=${encodeURIComponent(branch)}` : "";
  const apiUrl = `https://api.github.com/repos/${owner}/${repo}/contents/${path}${refSegment}`;
  const bodyEl = document.getElementById(bodyId);

  try {
    const items = await apiFetch(apiUrl);
    const dirs = Array.isArray(items) ? items.filter(i => i.type === "dir") : [];
    if (dirs.length === 0) {
      bodyEl.innerHTML = `<tr><td colspan="3" class="muted">Keine Unterordner unter <code>/${path}</code> gefunden.</td></tr>`;
      return;
    }

    const detailsPromises = dirs.map(async d => {
      const dirApi = `https://api.github.com/repos/${owner}/${repo}/contents/${path}/${d.name}${refSegment}`;
      try {
        const c = await apiFetch(dirApi);
        const pdfs = Array.isArray(c) ? c.filter(x => x.type === "file" && x.name.toLowerCase().endsWith(".pdf")) : [];
        return { name: d.name, pdfs };
      } catch {
        return { name: d.name, pdfs: [] };
      }
    });

    const details = await Promise.all(detailsPromises);
    bodyEl.innerHTML = "";
    details.sort((a,b)=> a.name.localeCompare(b.name, undefined, {numeric:true}));

    details.forEach(d => {
      const row = document.createElement("tr");
      const nameCell = document.createElement("td");
      nameCell.innerHTML = `<strong>${escapeHtml(d.name)}</strong>`;

      const pdfCell = document.createElement("td");
      if (d.pdfs.length > 0) {
        pdfCell.innerHTML = d.pdfs.map(pdf => {
          const blobUrl = `https://github.com/${owner}/${repo}/blob/${branch}/${path}/${encodeURIComponent(d.name)}/${encodeURIComponent(pdf.name)}`;
          return `<a class="folder-link" href="${blobUrl}" target="_blank" rel="noopener">${escapeHtml(pdf.name)}</a>`;
        }).join("<br>");
      } else {
        pdfCell.innerHTML = `<span class="muted">Keine PDF-Datei</span>`;
      }

      const linkCell = document.createElement("td");
      const ghPath = `https://github.com/${owner}/${repo}/tree/${branch}/${path}/${encodeURIComponent(d.name)}`;
      linkCell.innerHTML = `<a class="folder-link" href="${ghPath}" target="_blank" rel="noopener">Auf GitHub Ã¶ffnen</a>`;

      row.appendChild(nameCell);
      row.appendChild(pdfCell);
      row.appendChild(linkCell);
      bodyEl.appendChild(row);
    });
  } catch (err) {
    bodyEl.innerHTML = `<tr><td colspan="3" class="muted">Fehler beim Laden (${escapeHtml(err.message)}).</td></tr>`;
  }
}

// Start beide Tabellen laden
loadFolders("songs", "foldersBody");
loadFolders("songs-backlog", "backlogBody");
